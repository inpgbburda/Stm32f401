/**
* File contains 
*
*/

/*
|===================================================================================================================================|
    File includes 
|===================================================================================================================================|
*/
#include "stm32f401xc.h"
#include "spi.h"

/*
|===================================================================================================================================|
    Macro definitions
|===================================================================================================================================|
*/
#define GPIO_AFRL 0x00U
#define MODER0_ALT_FUN_MODE      GPIO_MODER_MODER0_1
#define AFRL_TIM1TIM2_SEL        GPIO_AFRL_AFSEL0_0
#define FIRST_PERIOD 0xFFU

/*
|===================================================================================================================================|
    Local types definitions 
|===================================================================================================================================|
*/


/*
|===================================================================================================================================|
    Object allocations 
|===================================================================================================================================|
*/


/*
|===================================================================================================================================|
    Local function declarations
|===================================================================================================================================|
*/

/*
|===================================================================================================================================|
    Function definitions
|===================================================================================================================================|
*/

void SpiInit(void)
{
    RCC->APB1ENR |= RCC_APB1ENR_SPI2EN; /* Enable clock for SPI2*/

    /*TODO choose alternate options for PORTS*/

    SPI2->CR1 |= SPI_CR1_DFF;  /* Set 16-bit format */
    SPI2->CR1 |= (SPI_CR1_CPOL | SPI_CR1_CPHA);
    SPI2->CR1 &= (~SPI_CR1_LSBFIRST); /* Set MSB first format*/
    SPI2->CR1 &= (SPI_CR1_SSM);   /* Configure NSS as Hardware, output disabled*/
    SPI2->CR1 &= (SPI_CR2_SSOE);
    SPI2->CR2 &= (~SPI_CR2_FRF);  /*Choose motorola mode*/
    SPI2->CR1 &= (~SPI_CR1_MSTR); /* MOSI pin is a data input */
    SPI2->CR1 |= SPI_CR1_SPE;     /* MISO pin is a data output */
}
