/**
* @file motor_ctrl.c
* @brief Module for converting received data into motor control signals.
*
*
* @note - 
* @attention - 
* @see - 
* @author
* @date 
*/

/*
|===================================================================================================================================|
    File includes 
|===================================================================================================================================|
*/
#ifndef _UNIT_TEST
#include "FreeRTOS.h"
#endif

#include "motor_ctrl.h"
#include "queue.h"
#include "pwm.h"
#include "pwm_cfg.h"

/*
|===================================================================================================================================|
    Macro definitions
|===================================================================================================================================|
*/
#define MAX_QUEUE_LENGTH 10

/*
|===================================================================================================================================|
    Local types definitions 
|===================================================================================================================================|
*/

/*
|===================================================================================================================================|
    Object allocations 
|===================================================================================================================================|
*/
static QueueHandle_t          inbox_queue_handle;
/*
|===================================================================================================================================|
    Local function declarations
|===================================================================================================================================|
*/

/*
|===================================================================================================================================|
    Function definitions
|===================================================================================================================================|
*/


void* MotorCtrlInit(void)
{
    inbox_queue_handle = xQueueCreate(MAX_QUEUE_LENGTH, MOTORS_NUMBER);
    return inbox_queue_handle;
}

void MotorCtrlExecutePeriodic(void)
{
    PowerRequestsPackage_T receivedMessage;
    BaseType_t queue_rx_status;
    PwmSetDuty(&Pwm2_Config, PWM_CHAN_1, 0);
    queue_rx_status = xQueueReceive(inbox_queue_handle, &receivedMessage, (TickType_t)100);
    
}
void CalculateMotorsSets(void)
{
    PwmSetDuty(&Pwm2_Config, 1, 1);
}